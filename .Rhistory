first[i] <- tempcut[1,1]
}
first <- as.Date(first,origin = "1970-01-01")
first <- data.frame(uscases$Combined_Key,first)
hist(first$first,breaks=n,main="Histogram of the date of first cases in the US",ylab="number of counties/cities",xlab="Date of First Case",freq=TRUE)
########################################################################################
####################################################################################################
################################################################################################################
uscases <- uscases[,-c(1)]
usdeaths <- usdeaths[,-c(1,2)] #use these for the c++ code
casemat <- as.matrix(uscases)
n<-ncol(uscases)
#trying to make a c++ funtion to speed it up
library(Rcpp)
cppFunction('int first(NumericMatrix uscases, int row){
int n = uscases.ncol();
NumericVector temp(n);
temp = uscases(row,_);
NumericVector date(n);
date[0] = 1;
for (int i=0; i<n; ++i){
date[i] += i;
}
int first = 0;
for (int i =0;i<n;++i){
if (temp[i] != 0){
first = date(i);
// return first;
}
if (temp[i] != 0){break;}
}
//int len = first.length();
return first;
}')
firstdate <- rep(0,nrow(uscases))
for(i in 1:nrow(uscases)-1){
firstdate[i] <- first(casemat,i)
}
firstdate <- firstdate[which(firstdate!=0)]
firstdate <- as.Date(firstdate,origin = "2020-01-22")
#first <- data.frame(uscases$Combined_Key,first)
hist(firstdate,breaks=n,main="Histogram of the date of first cases in the US",ylab="number of counties/cities",xlab="Date of First Case",freq=TRUE)
knitr::opts_chunk$set(echo = TRUE)
#importing Covid Data from Johns Hopkins
uscases <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv"))
usdeaths <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv"))
uscases <- uscases[,-c(1:5,8:11)]
usdeaths <- usdeaths[,-c(1:5,8:12)]
n <- ncol(uscases)-2
date <- 1:n
date <- as.Date(date,origin = "2020-01-21")
format(date,format = "%b %d %y")
#importing Covid Data from Johns Hopkins
uscases <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv"))
usdeaths <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv"))
uscases <- uscases[,-c(1:5,8:11)]
usdeaths <- usdeaths[,-c(1:5,8:12)]
n <- 126
date <- 1:n
date <- as.Date(date,origin = "2020-01-21")
format(date,format = "%b %d %y")
#finding total cases and turning them into a time series object
library(TSA)
totcase <- colSums(uscases[,3:(n+2)])
newcase <- rep(0,n)
newcase[1] <- totcase[1]
newcase[2:n] <- diff(totcase)
newcase <- ts(data=newcase,start=c(2020,01,22),frequency = 365)
#finding total cases and turning them into a time series object
library(TSA)
totcase <- colSums(uscases[,3:(n+2)])
newcase <- rep(0,n)
newcase[1] <- totcase[1]
newcase[2:n] <- diff(totcase)
newcase <- ts(data=newcase,start=c(2020,01,22),frequency = 365)
#finding total cases and turning them into a time series object
library(TSA)
totcase <- colSums(uscases[,3:(n+2)])
newcase <- rep(0,n)
newcase[1] <- totcase[1]
newcase[2:n] <- diff(totcase)
newcase <- ts(data=newcase,start=c(2020,01,22),frequency = 365)
#finding total cases and turning them into a time series object
library(TSA)
totcase <- colSums(uscases[,3:(n+2)])
newcase <- rep(0,n)
newcase[1] <- totcase[1]
newcase[2:n] <- diff(totcase)
newcase <- ts(data=newcase,start=c(2020,01,22),frequency = 365)
#trying various transformations
wkday <- c("W","T","F","S","S","M","T")
plot(date,newcase,type="o",main="Untransformed time series")
plot(date,log(newcase),type="o",main="Log time series")
plot(date[2:n],diff(newcase),type="o",main="First difference time series",pch=wkday)
plot(date[2:n],log(diff(newcase)),type="o",main="Log of first difference time series")
plot(date[8:n],diff(newcase,7),type="o",main="First weekly difference time series")
plot(date[9:n],diff(diff(newcase),7),type="o",main="First and weekly difference time series",pch=wkday)
#starting with an ARIMA model with both a first and first weekly difference
#preliminary analysis
transcase <- diff(diff(newcase),7)
acf(as.vector(transcase),main="ACF of transformed series",lag.max=30)
pacf(as.vector(transcase),main="PACF of transformed series",lag.max=30)
periodogram(transcase,main="Periodgram of transformed series")
#model fitting:
#looking at the periodograms, it appears a ARIMA(1,1,0)x(1,1,0)_7 is justified to start
tsmodel <- function(ar,ma,ars,mas){
mod <- arima(newcase,order=c(ar,1,ma),seasonal=list(order=c(ars,1,mas),period=7))
return(mod)
}
tsmodel(1,0,1,0)
tsmodel(2,0,1,0)
tsmodel(2,0,2,0)
tsmodel(3,0,2,0) #not significant
tsmodel(2,0,3,0) #not significant
tsmodel(2,1,2,0)
tsmodel(2,1,2,1)
tsmodel(2,2,2,1) #not significant
tsmodel(2,1,2,2) #R did not like this
#the final model is an ARIMA(2,1,2)X(2,1,1)_7
#diagnostics:
model<-tsmodel(2,1,2,2)
plot(date,model$residuals,main="model residuals",type="o")
acf(as.vector(model$residuals),main="ACF of model residuals")
qqnorm(model$residuals,main="QQ plot of model residuals")
hist(model$residuals,main="histogram of model residuals")
#predictions
predictions <- predict(model,n.ahead=10)
dateahead<- seq(from=(n+1),to=(n+10))
dateahead <- as.Date(dateahead,origin = "2020-01-21")
format(dateahead,format = "%b %d %y")
plot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
total <- c(newcase,predictions$pred)
plot(datenew,total,col=c(rep("black",n),rep("red",10)),main="Predicted Cases",type="o",ylab="Daily New Cases",xlab="Date")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
#predictions
predictions <- predict(model,n.ahead=10)
dateahead<- seq(from=(n+1),to=(n+10))
dateahead <- as.Date(dateahead,origin = "2020-01-21")
format(dateahead,format = "%b %d %y")
plot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
total <- c(newcase,predictions$pred)
plot(datenew,total,col=c(rep("black",n),rep("red",10)),main="Predicted Cases",type="o",ylab="Daily New Cases",xlab="Date")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
lot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
#predictions
predictions <- predict(model,n.ahead=10)
dateahead<- seq(from=(n+1),to=(n+10))
dateahead <- as.Date(dateahead,origin = "2020-01-21")
format(dateahead,format = "%b %d %y")
plot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
total <- c(newcase,predictions$pred)
plot(datenew,total,col=c(rep("black",n),rep("red",10)),main="Predicted Cases",type="o",ylab="Daily New Cases",xlab="Date")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
plot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
lines(datenew[127:136],colSums(uscases[,127:136]),type="o",col="black")
datenew[127:136]
#importing Covid Data from Johns Hopkins
uscases <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv"))
usdeaths <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv"))
uscases <- uscases[,-c(1:5,8:11)]
usdeaths <- usdeaths[,-c(1:5,8:12)]
n <- 127
date <- 1:n
date <- as.Date(date,origin = "2020-01-21")
format(date,format = "%b %d %y")
#finding total cases and turning them into a time series object
library(TSA)
totcase <- colSums(uscases[,3:(n+2)])
newcase <- rep(0,n)
newcase[1] <- totcase[1]
newcase[2:n] <- diff(totcase)
newcase <- ts(data=newcase,start=c(2020,01,22),frequency = 365)
#trying various transformations
wkday <- c("W","T","F","S","S","M","T")
plot(date,newcase,type="o",main="Untransformed time series")
plot(date,log(newcase),type="o",main="Log time series")
plot(date[2:n],diff(newcase),type="o",main="First difference time series",pch=wkday)
plot(date[2:n],log(diff(newcase)),type="o",main="Log of first difference time series")
plot(date[8:n],diff(newcase,7),type="o",main="First weekly difference time series")
plot(date[9:n],diff(diff(newcase),7),type="o",main="First and weekly difference time series",pch=wkday)
#starting with an ARIMA model with both a first and first weekly difference
#preliminary analysis
transcase <- diff(diff(newcase),7)
acf(as.vector(transcase),main="ACF of transformed series",lag.max=30)
pacf(as.vector(transcase),main="PACF of transformed series",lag.max=30)
periodogram(transcase,main="Periodgram of transformed series")
#model fitting:
#looking at the periodograms, it appears a ARIMA(1,1,0)x(1,1,0)_7 is justified to start
tsmodel <- function(ar,ma,ars,mas){
mod <- arima(newcase,order=c(ar,1,ma),seasonal=list(order=c(ars,1,mas),period=7))
return(mod)
}
tsmodel(1,0,1,0)
tsmodel(2,0,1,0)
tsmodel(2,0,2,0)
tsmodel(3,0,2,0) #not significant
tsmodel(2,0,3,0) #not significant
tsmodel(2,1,2,0)
tsmodel(2,1,2,1)
tsmodel(2,2,2,1) #not significant
tsmodel(2,1,2,2) #R did not like this
#the final model is an ARIMA(2,1,2)X(2,1,1)_7
#diagnostics:
model<-tsmodel(2,1,2,2)
plot(date,model$residuals,main="model residuals",type="o")
acf(as.vector(model$residuals),main="ACF of model residuals")
qqnorm(model$residuals,main="QQ plot of model residuals")
hist(model$residuals,main="histogram of model residuals")
#predictions
predictions <- predict(model,n.ahead=10)
dateahead<- seq(from=(n+1),to=(n+10))
dateahead <- as.Date(dateahead,origin = "2020-01-21")
format(dateahead,format = "%b %d %y")
plot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
total <- c(newcase,predictions$pred)
plot(datenew,total,col=c(rep("black",n),rep("red",10)),main="Predicted Cases",type="o",ylab="Daily New Cases",xlab="Date")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
plot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
lines(datenew[127:136],colSums(uscases[,127:136]),type="o",col="black")
colSums(uscases[,128:137])
#predictions
predictions <- predict(model,n.ahead=10)
dateahead<- seq(from=(n+1),to=(n+10))
dateahead <- as.Date(dateahead,origin = "2020-01-21")
format(dateahead,format = "%b %d %y")
plot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
total <- c(newcase,predictions$pred)
plot(datenew,total,col=c(rep("black",n),rep("red",10)),main="Predicted Cases",type="o",ylab="Daily New Cases",xlab="Date")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
plot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
newcasetot <- colSums(uscases[,128:137])
newnewcase <- rep(0,10)
newnewcase[1] <- newcasetot[1] - newcase[127]
newnewcase[2:10] <- diff(newcasetot)
lines(datenew[128:137],newnewcase,type="o",col="black")
newcase[127]
newcasetot
#predictions
predictions <- predict(model,n.ahead=10)
dateahead<- seq(from=(n+1),to=(n+10))
dateahead <- as.Date(dateahead,origin = "2020-01-21")
format(dateahead,format = "%b %d %y")
plot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
total <- c(newcase,predictions$pred)
plot(datenew,total,col=c(rep("black",n),rep("red",10)),main="Predicted Cases",type="o",ylab="Daily New Cases",xlab="Date")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
plot(dateahead,predictions$pred,main="Predicted and Observed Cases",type="o",ylim=c(5000,30000),ylab="Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
newcasetot <- colSums(uscases[,128:137])
newnewcase <- rep(0,10)
newnewcase[1] <- newcasetot[1] - totcase[127]
newnewcase[2:10] <- diff(newcasetot)
lines(datenew[128:137],newnewcase,type="o",col="black")
legend("bottomleft",legend=c("Observed","Predicted"),col=c("black","red"))
#predictions
predictions <- predict(model,n.ahead=10)
dateahead<- seq(from=(n+1),to=(n+10))
dateahead <- as.Date(dateahead,origin = "2020-01-21")
format(dateahead,format = "%b %d %y")
plot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
total <- c(newcase,predictions$pred)
plot(datenew,total,col=c(rep("black",n),rep("red",10)),main="Predicted Cases",type="o",ylab="Daily New Cases",xlab="Date")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
plot(dateahead,predictions$pred,main="Predicted and Observed Cases",type="o",ylim=c(5000,30000),ylab="Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
newcasetot <- colSums(uscases[,128:137])
newnewcase <- rep(0,10)
newnewcase[1] <- newcasetot[1] - totcase[127]
newnewcase[2:10] <- diff(newcasetot)
lines(datenew[128:137],newnewcase,type="o",col="black")
legend("bottomleft",legend=c("Observed","Predicted"),col=c("black","red"),
pch=c(1,1))
totcase[127]
newcasetot[1]
totcase
newcasetot
View(uscases)
#predictions
predictions <- predict(model,n.ahead=10)
dateahead<- seq(from=(n+1),to=(n+10))
dateahead <- as.Date(dateahead,origin = "2020-01-21")
format(dateahead,format = "%b %d %y")
plot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
total <- c(newcase,predictions$pred)
plot(datenew,total,col=c(rep("black",n),rep("red",10)),main="Predicted Cases",type="o",ylab="Daily New Cases",xlab="Date")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
plot(dateahead,predictions$pred,main="Predicted and Observed Cases",type="o",ylim=c(5000,30000),ylab="Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
newcasetot <- colSums(uscases[,131:140])
newnewcase <- rep(0,10)
newnewcase[1] <- newcasetot[1] - totcase[127]
newnewcase[2:10] <- diff(newcasetot)
lines(datenew[128:137],newnewcase,type="o",col="black")
legend("bottomleft",legend=c("Observed","Predicted"),col=c("black","red"),
pch=c(1,1))
newcasetot
totcase
#predictions
predictions <- predict(model,n.ahead=10)
dateahead<- seq(from=(n+1),to=(n+10))
dateahead <- as.Date(dateahead,origin = "2020-01-21")
format(dateahead,format = "%b %d %y")
plot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
total <- c(newcase,predictions$pred)
plot(datenew,total,col=c(rep("black",n),rep("red",10)),main="Predicted Cases",type="o",ylab="Daily New Cases",xlab="Date")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
plot(dateahead,predictions$pred,main="Predicted and Observed Cases",type="o",ylim=c(5000,30000),ylab="Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
newcasetot <- colSums(uscases[,130:149])
#predictions
predictions <- predict(model,n.ahead=10)
dateahead<- seq(from=(n+1),to=(n+10))
dateahead <- as.Date(dateahead,origin = "2020-01-21")
format(dateahead,format = "%b %d %y")
plot(dateahead,predictions$pred,main="Predicted Cases",type="o",ylim=c(5000,30000),ylab="Predicted Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
total <- c(newcase,predictions$pred)
plot(datenew,total,col=c(rep("black",n),rep("red",10)),main="Predicted Cases",type="o",ylab="Daily New Cases",xlab="Date")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
plot(dateahead,predictions$pred,main="Predicted and Observed Cases",type="o",ylim=c(5000,30000),ylab="Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
newcasetot <- colSums(uscases[,130:139])
newnewcase <- rep(0,10)
newnewcase[1] <- newcasetot[1] - totcase[127]
newnewcase[2:10] <- diff(newcasetot)
lines(datenew[128:137],newnewcase,type="o",col="black")
legend("bottomleft",legend=c("Observed","Predicted"),col=c("black","red"),
pch=c(1,1))
plot(dateahead,predictions$pred,main="Predicted and Observed Cases",type="o",ylim=c(5000,30000),ylab="Daily New Cases",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
newcasetot <- colSums(uscases[,130:139])
newnewcase <- rep(0,10)
newnewcase[1] <- newcasetot[1] - totcase[127]
newnewcase[2:10] <- diff(newcasetot)
lines(datenew[128:137],newnewcase,type="o",col="black")
legend("bottomleft",legend=c("Observed","Predicted"),col=c("black","red"),
pch=c(1,1))
knitr::opts_chunk$set(echo = TRUE)
#importing Covid Data from Johns Hopkins
uscases <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv"))
usdeaths <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv"))
uscases <- uscases[,-c(1:5,8:11)]
usdeaths <- usdeaths[,-c(1:5,8:12)]
n <- ncol(uscases)-2
date <- 1:n
date <- as.Date(date,origin = "2020-01-21")
format(date,format = "%b %d %y")
#importing Covid Data from Johns Hopkins
uscases <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv"))
usdeaths <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv"))
uscases <- uscases[,-c(1:5,8:11)]
usdeaths <- usdeaths[,-c(1:5,8:12)]
n <-  127
date <- 1:n
date <- as.Date(date,origin = "2020-01-21")
format(date,format = "%b %d %y")
#finding total cases and turning them into a time series object
library(TSA)
totdeath <- colSums(usdeaths[,3:(n+2)])
newdeath <- rep(0,n)
newdeath[1] <- totdeath[1]
newdeath[2:n] <- diff(totdeath)
newdeath <- ts(data=newdeath,start=c(2020,01,22),frequency = 365)
#trying various transformations
wkday <- c("W","T","F","S","S","M","T")
plot(date,newdeath,type="o",main="Untransformed time series")
plot(date,log(newdeath),type="o",main="Log time series")
plot(date[2:n],diff(newdeath),type="o",main="First difference time series",pch=wkday)
plot(date[2:n],log(diff(newdeath)),type="o",main="Log of first difference time series")
plot(date[8:n],diff(newdeath,7),type="o",main="First weekly difference time series")
plot(date[9:n],diff(diff(newdeath),7),type="o",main="First and weekly difference time series",pch=wkday)
#starting with an ARIMA model with both a first and first weekly difference
#preliminary analysis
transdeath <- diff(diff(newdeath),7)
acf(as.vector(transdeath),main="ACF of transformed series",lag.max=30)
pacf(as.vector(transdeath),main="PACF of transformed series",lag.max=30)
periodogram(transdeath,main="Periodgram of transformed series")
#model fitting:
#looking at the periodograms, it appears a ARIMA(1,1,0)x(1,1,0)_7 is justified to start
tsmodel <- function(ar,ma,ars,mas){
mod <- arima(newdeath,order=c(ar,1,ma),seasonal=list(order=c(ars,1,mas),period=7))
return(mod)
}
tsmodel(1,0,1,0)
tsmodel(2,0,1,0)
tsmodel(3,0,1,0)
tsmodel(3,0,2,0) #not significant
tsmodel(3,1,1,0) #not significant
tsmodel(3,0,1,1) #not stationary
#the final model is an ARIMA(3,1,0)X(1,1,0)_7
#diagnostics:
model<-tsmodel(3,0,1,0)
plot(date,model$residuals,main="model residuals",type="o")
acf(as.vector(model$residuals),main="ACF of model residuals")
qqnorm(model$residuals,main="QQ plot of model residuals")
hist(model$residuals,main="histogram of model residuals")
#predictions
predictions <- predict(model,n.ahead=10)
dateahead<- seq(from=(n+1),to=(n+10))
dateahead <- as.Date(dateahead,origin = "2020-01-21")
format(dateahead,format = "%b %d %y")
plot(dateahead,predictions$pred,main="Predicted Deaths",type="o",ylim=c(0,2000),ylab="Predicted Daily New Deaths",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
total <- c(newdeath,predictions$pred)
plot(datenew,total,col=c(rep("black",n),rep("red",10)),main="Predicted Deaths",type="o",ylab="Daily New Deaths",xlab="Date")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
#predictions
predictions <- predict(model,n.ahead=10)
dateahead<- seq(from=(n+1),to=(n+10))
dateahead <- as.Date(dateahead,origin = "2020-01-21")
format(dateahead,format = "%b %d %y")
plot(dateahead,predictions$pred,main="Predicted Deaths",type="o",ylim=c(0,2000),ylab="Predicted Daily New Deaths",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
datenew <- c(date,dateahead)
total <- c(newdeath,predictions$pred)
plot(datenew,total,col=c(rep("black",n),rep("red",10)),main="Predicted Deaths",type="o",ylab="Daily New Deaths",xlab="Date")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
plot(dateahead,predictions$pred,main="Predicted Deaths",type="o",ylim=c(0,2000),ylab="Predicted Daily New Deaths",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
newdeathtot <- colSums(usdeaths[,130:139])
newnewdeath <- rep(0,10)
newnewdeath[1] <- newdeathtot[1] - totdeath[127]
newnewdeath[2:10] <- diff(newdeathtot)
lines(datenew[128:137],newnewdeath,type="o",col="black")
legend("bottomleft",legend=c("Observed","Predicted"),col=c("black","red"),
pch=c(1,1))
plot(dateahead,predictions$pred,main="Predicted Deaths",type="o",ylim=c(0,2000),ylab="Predicted Daily New Deaths",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
newdeathtot <- colSums(usdeaths[,130:139])
newnewdeath <- rep(0,10)
newnewdeath[1] <- newdeathtot[1] - totdeath[127]
newnewdeath[2:10] <- diff(newdeathtot)
lines(datenew[128:137],newnewdeath,type="o",col="black")
legend("bottomleft",legend=c("Observed","Predicted"),col=c("black","red"),
pch=c(1,1))
plot(dateahead,predictions$pred,main="Predicted and Observed Deaths",type="o",ylim=c(0,2000),ylab="Daily New Deaths",xlab="Date",col="red")
lines(dateahead,(predictions$pred - 1.96*predictions$se),type="l",col="red")
lines(dateahead,(predictions$pred + 1.96*predictions$se),type="l",col="red")
newdeathtot <- colSums(usdeaths[,130:139])
newnewdeath <- rep(0,10)
newnewdeath[1] <- newdeathtot[1] - totdeath[127]
newnewdeath[2:10] <- diff(newdeathtot)
lines(datenew[128:137],newnewdeath,type="o",col="black")
legend("bottomleft",legend=c("Observed","Predicted"),col=c("black","red"),
pch=c(1,1))
